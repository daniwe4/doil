version: "3.5"
services:
  doil_http:
    build:
      context: .
      dockerfile: Dockerfile
    image: doil_http:stable
    container_name: doil_http
    hostname: http
    domainname: http
    networks:
      doil_proxy:
        ipv4_address: 172.24.0.252
      salt_saltnet:
    volumes:
      - /usr/local/share/doil/http:/srv/http
      - type: bind
        source: ./conf/salt-startup.sh
        target: /root/salt-startup.sh
      - type: bind
        source: ./conf/startup.conf
        target: /etc/supervisor/conf.d/startup.conf
      - type: bind
        source: ./conf/salt-minion.conf
        target: /etc/supervisor/conf.d/salt-minion.conf
      - type: bind
        source: ./conf/minion.cnf
        target: /etc/salt/minion
      - type: bind
        source: ./conf/apache.conf
        target: /etc/supervisor/conf.d/apache.conf
networks:
  doil_proxy:
    external: true
  salt_saltnet:
    external: true